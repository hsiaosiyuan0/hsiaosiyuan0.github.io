<!DOCTYPE html><html><head><title>Crypto-conditions 简述</title><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1, user-scalable=no, viewport-fit=cover"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-one-dark.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/toolbar/prism-toolbar.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-highlight/prism-line-highlight.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/material-icons@0.3.1/iconfont/material-icons.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/material-icons@0.3.1/css/material-icons.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3.2.1/dist/style.min.css"/><link rel="stylesheet" href="/outlet__outlets_default_tsx.css"/><link rel="stylesheet" href="/pages/post.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-64334326-2"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-64334326-2');</script></head><body><div id="__gadget__"><div><div class="" style="position:fixed;top:0;left:0;height:2px;background:transparent;z-index:99999999999;width:100%"><div style="height:100%;background:#2998ff;transition:all 500ms ease;width:0%"><div style="box-shadow:0 0 10px #2998ff, 0 0 10px #2998ff;width:5%;opacity:1;position:absolute;height:100%;transition:all 500ms ease;transform:rotate(3deg) translate(0px, -4px);left:-10rem"></div></div></div><div class="_3k0uOgdSRfNa0MZs6QS7ku"><div class="_1G63502GZaEXBXykcWz6cX">The hard ways</div><div style="padding-right:20px"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="_3HRY5_KLp8kngNq9437Zqi"><a href="/sitemap.html">all</a></div></div><div class="Z_a6ax5LrTSVASNRR2aN6 _11dH37BK8JkWofQgbOzM4L"><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>v8</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/v8/debug-v8-in-vscode.html"><i class=""></i><span>在 VSCode 中调试 v8 源码</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/v8/common-data-types.html"><i class=""></i><span>v8 常见数据类型</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>deno</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/deno/native-plugin.html"><i class=""></i><span>deno native plugin 内部实现机制</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>crypto</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/crypto/brief-crypto.html"><i class=""></i><span>加密算法调研</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>nodejs</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/Cluster 模块分析.html"><i class=""></i><span>Cluster 模块分析</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/build-from-source.html"><i class=""></i><span>从源码构建 node.js</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/node-addon.html"><i class=""></i><span>Node.js 扩展</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/common-snippet.html"><i class=""></i><span>Node 源码中的常见代码</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/heap-snapshot.html"><i class=""></i><span>v8 Heapsnapshot 文件解析</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/libuv.html"><i class=""></i><span>Libuv 之 - 只看这篇是不够的</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/object-in-v8.html"><i class=""></i><span>Objects in V8</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/nodejs/node-on-libuv.html"><i class=""></i><span>Libuv 之上的 Node</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>websocket</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/websocket/WebSocket 协议 1~4 节.html"><i class=""></i><span>WebSocket 协议 1~4 节</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/websocket/WebSocket 协议 5~10 节.html"><i class=""></i><span>WebSocket 协议 5~10 节</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>assembly</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/assembly/汇编语言学习小结.html"><i class=""></i><span>汇编语言学习小结</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>typescript</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/typescript/decorator.html"><i class=""></i><span>Decorator in babel and tsc</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>rust</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/rust/lifetime.html"><i class=""></i><span>Lifetime</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>oop</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/oop/ioc.html"><i class=""></i><span>Midway 分析</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>php</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/php/为什么 PHP 不适合长时间运行.html"><i class=""></i><span>为什么 PHP 不适合长时间运行</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>blockchain</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/blockchain/crypto-conditions 简述.html"><i class=""></i><span>Crypto-conditions 简述</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/blockchain/实用拜占庭容错简介.html"><i class=""></i><span>实用拜占庭容错简介</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>browser</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/browser/浏览器异步加载和同源策略.html"><i class=""></i><span>浏览器异步加载和同源策略</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>cpp</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/cpp/the-as-if-rule.html"><i class=""></i><span>The as-if rule</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>work</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/work/parsing-in-practice.html"><i class=""></i><span>Parsing in practice</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>os</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/os/大小端序.html"><i class=""></i><span>大小端序</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/os/UTF-8 编码及检查其完整性.html"><i class=""></i><span>UTF-8 编码及检查其完整性</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/os/魔数0x7c00.html"><i class=""></i><span>魔数 0x7c00</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/os/字符集和字符编码.html"><i class=""></i><span>字符集和字符编码</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>javascript</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/javascript/generator function.html"><i class=""></i><span>Generator Function</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/javascript/解析 JSON 的成本.html"><i class=""></i><span>解析 JSON 的成本</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/javascript/Javascript 内部的字符编码.html"><i class=""></i><span>Javascript 内部的字符编码</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/javascript/闭包的作用.html"><i class=""></i><span>闭包的作用</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/javascript/闭包是什么.html"><i class=""></i><span>闭包是什么</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>static-analysis</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/static-analysis/ternjs.html"><i class=""></i><span>使用 Rust 重写 ternjs</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>craft</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/craft/create_your_own_lang.html"><i class=""></i><span>制作一个属于自己的语言</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>go</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/go/bad_in_generic_syntax.html"><i class=""></i><span>Go 语言中的 Generic 设计缺陷</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>scratch</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/scratch/初唐四杰.html"><i class=""></i><span>初唐四杰</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/scratch/最好的博客工具.html"><i class=""></i><span>最好的博客工具</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:28px" href="/post/scratch/鲁迅.html"><i class=""></i><span>鲁迅</span></a><ul></ul></div></li></ul></div></div><div class="rWpFqfkPbEcRx8xnnjlEm article line-numbers"><div><div><h1 id="Crypto-conditions简述">Crypto-conditions 简述</h1>
<blockquote>
<p>下文将 crypto-conditions 简称为 cc
cc 的详细的文档描述见 <a href="https://tools.ietf.org/html/draft-thomas-crypto-conditions-04">ietf</a></p>
</blockquote>
<p>在现有的 public-key 这样的签名策略下，消息的传递过程如下:</p>
<ol>
<li>消息发送方 A 先将需要发送给消息接受方 B 的消息 M 进行摘要 <code>H = hash(M)</code></li>
<li>A 用自己的私钥对摘要进行加密得到 AEH (A&#x27;s encrypted hash 即 signature)</li>
<li>A 将要发送的消息 M 以及签名 AEH 发送给 B</li>
<li>B 接受到 M 后，对 M 进行摘要得到 BH</li>
<li>B 使用 A 的公钥对 AEH 进行解密，得到 AH</li>
<li>B 通过判断 <code>BH == AH</code> 是否成立来确定消息是否来自于 A</li>
</ol>
<p>可以看到在 public-key 策略下，对一个消息的合法性的校验，发送方被限制成了单个实体 (one keypair)、单个条件 (签名匹配)</p>
<p>而 cc，则提供一个将现有加密验证算法进行条件组合的功能，比如上面的例子是 A 给 B 发送了消息，B 希望验证这个消息是 A 发送的。通过 cc，可以实现 A、C、D 一起给 B 发送了一个消息，B 可以验证 A、C、D 一起发送的，又或者 A、C、D 一起给 B 发送了一个消息，同时告诉 B，它们之间只要确定两个人，就可以证明消息的正确性，那么当 B 验证时，只要确保三人之间通过两人即可。</p>
<p>在 chaindb 的关于 cc 的<a href="https://docs.bigchaindb.com/projects/server/en/v0.8.2/data-models/crypto-conditions.html">文档</a>中，有这样的例子：</p>
<pre><code class="language-js">{
    &quot;cid&quot;: &quot;&lt;condition index&gt;&quot;,
    &quot;condition&quot;: {
        &quot;details&quot;: {
            &quot;bitmask&quot;: 41,
            &quot;subfulfillments&quot;: [
                {
                    &quot;bitmask&quot;: 32,
                    &quot;public_key&quot;: &quot;&lt;new owner 1 public key&gt;&quot;,
                    &quot;signature&quot;: null,
                    &quot;type&quot;: &quot;fulfillment&quot;,
                    &quot;type_id&quot;: 4,
                    &quot;weight&quot;: 1
                },
                {
                    &quot;bitmask&quot;: 32,
                    &quot;public_key&quot;: &quot;&lt;new owner 2 public key&gt;&quot;,
                    &quot;signature&quot;: null,
                    &quot;type&quot;: &quot;fulfillment&quot;,
                    &quot;type_id&quot;: 4,
                    &quot;weight&quot;: 1
                }
            ],
            &quot;threshold&quot;: 2,
            &quot;type&quot;: &quot;fulfillment&quot;,
            &quot;type_id&quot;: 2
        },
        &quot;uri&quot;: &quot;cc:2:29:ytNK3X6-bZsbF-nCGDTuopUIMi1HCyCkyPewm6oLI3o:206&quot;},
        &quot;owners_after&quot;: [
            &quot;owner 1 public key&gt;&quot;,
            &quot;owner 2 public key&gt;&quot;
        ]
}
</code></pre>
<p>这里条件被划分为两个子条件，包含在 <code>subfulfillments</code>  中，<code>threshold</code> 为 2，表示需要两个子条件同时满足。</p>
<p>在 cc 的文档中有描述到，<a href="https://tools.ietf.org/html/draft-thomas-crypto-conditions-04#section-4.3">sec 4.3</a>：</p>
<blockquote>
<p>Crypto-conditions elegantly support weighted multi-signatures and
multi-level signatures.  A threshold condition has a number of
subconditions, and a target threshold.  Each subcondition can be a
signature or another threshold condition.  This provides flexibility
in forming complex conditions.</p>
<p>For example, consider a threshold condition that consists of two
subconditions, one each from Wayne and Alf. Alf&#x27;s condition can be a
signature condition while Wayne&#x27;s condition is a threshold condition,
requiring both Claude and Dan to sign for him.</p>
<p>Multi-level signatures allow more complex relationships than simple
M-of-N signing.  For example, a weighted condition can support an
arrangement of subconditions such as, &quot;Either Ron, Mac, and Ped must
approve; or Smithers must approve.&quot;</p>
</blockquote>
<p>就是条件理论上是支持被无限的划分为子条件的，那么在验证的时候，势必需要一个递归的程序，所以文档中还包含了 <code>cost</code> 的概念，因为每个条件的最终表现形态 (atom) 还是利用的已有的加密算法，比如 hash，rsa 等等，那么对每个已有的加密算法，都指定一个固定的 cost，而当条件制定方在制定自己的条件时，同时也将给出其中包含的所有 atom 元素的 cost 加法结果。当然校验方也不会仅仅认定条件方给出的 cost 值，不过可以作为一个预先的判断。</p>
<p>cost 的目的是，上文说道在校验时势必有一个递归的程序，那么如果接受任意嵌套的条件的话，比如会受到恶意攻击，比如构造一个足够深入的条件，导致校验方在校验条件时花费过多的资源，甚至宕机。</p>
<p>总的来说，cc 并没有提供或者创新一个新的加密算法，只是提供一个将现有加密算法进行一个条件组装，并对组装后的条件如何验证进行描述的一套机制。</p>
<p>参考 chaindb 的实现，至少在 js driver 中，虽然利用了 cc，不过也只是支持了 cc 中单个扁平条件下的 <code>ED25519-SHA256</code>，换句话说，和现有的 public-key 机制没有任何区别。</p>
<p>以使用 neo 搭建私有链的经验来看 <a href="http://docs.neo.org/zh-cn/network/private-chain/private-chain.html">搭建私有链 - 第 5 节</a>，多方签名是需要多方进行配合的，比如在 neo wallet 中会让你将一个账号的签名结果拿出来给到另一个钱包账号再进行签名，在 chaindb 中没有看到提供这样的手段。</p>
<p>最初认为 cc 只需要简单的了解下，但是在这几天对 chaindb 的逐步了解中，会发现这是其中的重要一环。</p>
<p>chaindb 的构架</p>
<pre><code>chaindb-core
   +   ^
   |   |
   v   +
 tendermint
</code></pre>
<p>可以看到，core 是基于 tendermint 之上的，因为 tendermint 将分布式以及共识的任务都完成了，准确的说是分布式完成，以及共识接口的完成，具体的共识细节，则需要由位于他上层的应用来实现，比如这里的 core。</p>
<p>那么现在很明显，各个节点之间，需要就什么来达成共识? 对于分布式记账系统而言，无非就是交易 (tx)，那么共识的内容无非也就是验证交易的合法性。交易的合法性除了包括简单的交易格式是否正确，是否双花等等，其中重要的一环就是交易是否由 owner(s) 授权，这就是 cc 所涉及的部分。</p>
<p>所以接下来，将会新的深入的角度，通过分析 <a href="https://github.com/interledgerjs/five-bells-condition">five-bells-condition</a> 的代码来次深入的学习 cc。</p>
<p><code>five-bells-condition</code> 是 cc 的 js 实现。</p></div></div></div><div class="_3a4jt6lr4yLRJnQge009wv"><ul></ul></div><div class="_1UY_ItV2UTWKutKs5b7NKg">Made with <a target="_blank" href="https://github.com/hsiaosiyuan0/gadget">gadget</a></div></div></div><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-core.min.js" data-manual="true"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-markup.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-clike.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-json.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-javascript.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-jsx.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-typescript.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-tsx.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-bash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-python.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-xml-doc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-docker.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-rust.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-nasm.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-c.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-cpp.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-xml-doc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-go.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-nim.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-highlight/prism-line-highlight.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@5.1.1/dist/gumshoe.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react@16.14.0/umd/react.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-dom@16.14.0/umd/react-dom.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react@16.14.0/umd/react.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-dom@16.14.0/umd/react-dom.production.min.js"></script><script>window["__gadget__"]={"initialProps":{"data":{"post":{"filename":"crypto-conditions 简述","rawMeta":{"title":"Crypto-conditions 简述"},"content":"# Crypto-conditions 简述\n\n> 下文将 crypto-conditions 简称为 cc\n> cc 的详细的文档描述见 [ietf](https://tools.ietf.org/html/draft-thomas-crypto-conditions-04)\n\n在现有的 public-key 这样的签名策略下，消息的传递过程如下:\n1. 消息发送方 A 先将需要发送给消息接受方 B 的消息 M 进行摘要 `H = hash(M)`\n2. A 用自己的私钥对摘要进行加密得到 AEH (A's encrypted hash 即 signature)\n3. A 将要发送的消息 M 以及签名 AEH 发送给 B\n4. B 接受到 M 后，对 M 进行摘要得到 BH\n5. B 使用 A 的公钥对 AEH 进行解密，得到 AH\n6. B 通过判断 `BH == AH` 是否成立来确定消息是否来自于 A\n\n可以看到在 public-key 策略下，对一个消息的合法性的校验，发送方被限制成了单个实体 (one keypair)、单个条件 (签名匹配)\n\n而 cc，则提供一个将现有加密验证算法进行条件组合的功能，比如上面的例子是 A 给 B 发送了消息，B 希望验证这个消息是 A 发送的。通过 cc，可以实现 A、C、D 一起给 B 发送了一个消息，B 可以验证 A、C、D 一起发送的，又或者 A、C、D 一起给 B 发送了一个消息，同时告诉 B，它们之间只要确定两个人，就可以证明消息的正确性，那么当 B 验证时，只要确保三人之间通过两人即可。\n\n在 chaindb 的关于 cc 的[文档](https://docs.bigchaindb.com/projects/server/en/v0.8.2/data-models/crypto-conditions.html)中，有这样的例子：\n\n```js\n{\n    \"cid\": \"<condition index>\",\n    \"condition\": {\n        \"details\": {\n            \"bitmask\": 41,\n            \"subfulfillments\": [\n                {\n                    \"bitmask\": 32,\n                    \"public_key\": \"<new owner 1 public key>\",\n                    \"signature\": null,\n                    \"type\": \"fulfillment\",\n                    \"type_id\": 4,\n                    \"weight\": 1\n                },\n                {\n                    \"bitmask\": 32,\n                    \"public_key\": \"<new owner 2 public key>\",\n                    \"signature\": null,\n                    \"type\": \"fulfillment\",\n                    \"type_id\": 4,\n                    \"weight\": 1\n                }\n            ],\n            \"threshold\": 2,\n            \"type\": \"fulfillment\",\n            \"type_id\": 2\n        },\n        \"uri\": \"cc:2:29:ytNK3X6-bZsbF-nCGDTuopUIMi1HCyCkyPewm6oLI3o:206\"},\n        \"owners_after\": [\n            \"owner 1 public key>\",\n            \"owner 2 public key>\"\n        ]\n}\n```\n\n这里条件被划分为两个子条件，包含在 `subfulfillments`  中，`threshold` 为 2，表示需要两个子条件同时满足。\n\n在 cc 的文档中有描述到，[sec 4.3](https://tools.ietf.org/html/draft-thomas-crypto-conditions-04#section-4.3)：\n\n>  Crypto-conditions elegantly support weighted multi-signatures and\n>  multi-level signatures.  A threshold condition has a number of\n>  subconditions, and a target threshold.  Each subcondition can be a\n>  signature or another threshold condition.  This provides flexibility\n>  in forming complex conditions.\n>\n>  For example, consider a threshold condition that consists of two\n>  subconditions, one each from Wayne and Alf. Alf's condition can be a\n>  signature condition while Wayne's condition is a threshold condition,\n>  requiring both Claude and Dan to sign for him.\n>\n>  Multi-level signatures allow more complex relationships than simple\n>  M-of-N signing.  For example, a weighted condition can support an\n>  arrangement of subconditions such as, \"Either Ron, Mac, and Ped must\n>  approve; or Smithers must approve.\"\n\n就是条件理论上是支持被无限的划分为子条件的，那么在验证的时候，势必需要一个递归的程序，所以文档中还包含了 `cost` 的概念，因为每个条件的最终表现形态 (atom) 还是利用的已有的加密算法，比如 hash，rsa 等等，那么对每个已有的加密算法，都指定一个固定的 cost，而当条件制定方在制定自己的条件时，同时也将给出其中包含的所有 atom 元素的 cost 加法结果。当然校验方也不会仅仅认定条件方给出的 cost 值，不过可以作为一个预先的判断。\n\ncost 的目的是，上文说道在校验时势必有一个递归的程序，那么如果接受任意嵌套的条件的话，比如会受到恶意攻击，比如构造一个足够深入的条件，导致校验方在校验条件时花费过多的资源，甚至宕机。\n\n总的来说，cc 并没有提供或者创新一个新的加密算法，只是提供一个将现有加密算法进行一个条件组装，并对组装后的条件如何验证进行描述的一套机制。\n\n参考 chaindb 的实现，至少在 js driver 中，虽然利用了 cc，不过也只是支持了 cc 中单个扁平条件下的 `ED25519-SHA256`，换句话说，和现有的 public-key 机制没有任何区别。\n\n以使用 neo 搭建私有链的经验来看 [搭建私有链 - 第 5 节](http://docs.neo.org/zh-cn/network/private-chain/private-chain.html)，多方签名是需要多方进行配合的，比如在 neo wallet 中会让你将一个账号的签名结果拿出来给到另一个钱包账号再进行签名，在 chaindb 中没有看到提供这样的手段。\n\n最初认为 cc 只需要简单的了解下，但是在这几天对 chaindb 的逐步了解中，会发现这是其中的重要一环。\n\nchaindb 的构架\n\n```\nchaindb-core\n   +   ^\n   |   |\n   v   +\n tendermint\n```\n\n可以看到，core 是基于 tendermint 之上的，因为 tendermint 将分布式以及共识的任务都完成了，准确的说是分布式完成，以及共识接口的完成，具体的共识细节，则需要由位于他上层的应用来实现，比如这里的 core。\n\n那么现在很明显，各个节点之间，需要就什么来达成共识? 对于分布式记账系统而言，无非就是交易 (tx)，那么共识的内容无非也就是验证交易的合法性。交易的合法性除了包括简单的交易格式是否正确，是否双花等等，其中重要的一环就是交易是否由 owner(s) 授权，这就是 cc 所涉及的部分。\n\n所以接下来，将会新的深入的角度，通过分析 [five-bells-condition](https://github.com/interledgerjs/five-bells-condition) 的代码来次深入的学习 cc。\n\n`five-bells-condition` 是 cc 的 js 实现。 ","slug":"/blockchain/crypto-conditions 简述","toc":[],"keywords":[],"mtime":1666195159817},"catalog":[{"name":"v8","url":"/post/v8","children":[{"name":"在 VSCode 中调试 v8 源码","url":"/post/v8/debug-v8-in-vscode.html","children":[]},{"name":"v8 常见数据类型","url":"/post/v8/common-data-types.html","children":[]}]},{"name":"deno","url":"/post/deno","children":[{"name":"deno native plugin 内部实现机制","url":"/post/deno/native-plugin.html","children":[]}]},{"name":"crypto","url":"/post/crypto","children":[{"name":"加密算法调研","url":"/post/crypto/brief-crypto.html","children":[]}]},{"name":"nodejs","url":"/post/nodejs","children":[{"name":"Cluster 模块分析","url":"/post/nodejs/Cluster 模块分析.html","children":[]},{"name":"从源码构建 node.js","url":"/post/nodejs/build-from-source.html","children":[]},{"name":"Node.js 扩展","url":"/post/nodejs/node-addon.html","children":[]},{"name":"Node 源码中的常见代码","url":"/post/nodejs/common-snippet.html","children":[]},{"name":"v8 Heapsnapshot 文件解析","url":"/post/nodejs/heap-snapshot.html","children":[]},{"name":"Libuv 之 - 只看这篇是不够的","url":"/post/nodejs/libuv.html","children":[]},{"name":"Objects in V8","url":"/post/nodejs/object-in-v8.html","children":[]},{"name":"Libuv 之上的 Node","url":"/post/nodejs/node-on-libuv.html","children":[]}]},{"name":"websocket","url":"/post/websocket","children":[{"name":"WebSocket 协议 1~4 节","url":"/post/websocket/WebSocket 协议 1~4 节.html","children":[]},{"name":"WebSocket 协议 5~10 节","url":"/post/websocket/WebSocket 协议 5~10 节.html","children":[]}]},{"name":"assembly","url":"/post/assembly","children":[{"name":"汇编语言学习小结","url":"/post/assembly/汇编语言学习小结.html","children":[]}]},{"name":"typescript","url":"/post/typescript","children":[{"name":"Decorator in babel and tsc","url":"/post/typescript/decorator.html","children":[]}]},{"name":"rust","url":"/post/rust","children":[{"name":"Lifetime","url":"/post/rust/lifetime.html","children":[]}]},{"name":"oop","url":"/post/oop","children":[{"name":"Midway 分析","url":"/post/oop/ioc.html","children":[]}]},{"name":"php","url":"/post/php","children":[{"name":"为什么 PHP 不适合长时间运行","url":"/post/php/为什么 PHP 不适合长时间运行.html","children":[]}]},{"name":"blockchain","url":"/post/blockchain","children":[{"name":"Crypto-conditions 简述","url":"/post/blockchain/crypto-conditions 简述.html","children":[]},{"name":"实用拜占庭容错简介","url":"/post/blockchain/实用拜占庭容错简介.html","children":[]}]},{"name":"browser","url":"/post/browser","children":[{"name":"浏览器异步加载和同源策略","url":"/post/browser/浏览器异步加载和同源策略.html","children":[]}]},{"name":"cpp","url":"/post/cpp","children":[{"name":"The as-if rule","url":"/post/cpp/the-as-if-rule.html","children":[]}]},{"name":"work","url":"/post/work","children":[{"name":"Parsing in practice","url":"/post/work/parsing-in-practice.html","children":[]}]},{"name":"os","url":"/post/os","children":[{"name":"大小端序","url":"/post/os/大小端序.html","children":[]},{"name":"UTF-8 编码及检查其完整性","url":"/post/os/UTF-8 编码及检查其完整性.html","children":[]},{"name":"魔数 0x7c00","url":"/post/os/魔数0x7c00.html","children":[]},{"name":"字符集和字符编码","url":"/post/os/字符集和字符编码.html","children":[]}]},{"name":"javascript","url":"/post/javascript","children":[{"name":"Generator Function","url":"/post/javascript/generator function.html","children":[]},{"name":"解析 JSON 的成本","url":"/post/javascript/解析 JSON 的成本.html","children":[]},{"name":"Javascript 内部的字符编码","url":"/post/javascript/Javascript 内部的字符编码.html","children":[]},{"name":"闭包的作用","url":"/post/javascript/闭包的作用.html","children":[]},{"name":"闭包是什么","url":"/post/javascript/闭包是什么.html","children":[]}]},{"name":"static-analysis","url":"/post/static-analysis","children":[{"name":"使用 Rust 重写 ternjs","url":"/post/static-analysis/ternjs.html","children":[]}]},{"name":"craft","url":"/post/craft","children":[{"name":"制作一个属于自己的语言","url":"/post/craft/create_your_own_lang.html","children":[]}]},{"name":"go","url":"/post/go","children":[{"name":"Go 语言中的 Generic 设计缺陷","url":"/post/go/bad_in_generic_syntax.html","children":[]}]},{"name":"scratch","url":"/post/scratch","children":[{"name":"初唐四杰","url":"/post/scratch/初唐四杰.html","children":[]},{"name":"最好的博客工具","url":"/post/scratch/最好的博客工具.html","children":[]},{"name":"鲁迅","url":"/post/scratch/鲁迅.html","children":[]}]}],"title":"The hard ways"}},"currentRoute":{"pattern":"/post","href":{"pathname":"/post"}},"pageModules":{"/index":["/pages/index.js"],"/post":["/pages/post.css","/pages/post.js"],"/sitemap":["/pages/sitemap.css","/pages/sitemap.js"],"/post/*":["/pages/post.css","/pages/post.js"]},"router":{"basename":"/","hash":false,"routes":["/index","/post","/sitemap","/post/*"]}};</script><script crossorigin="anonymous" src="/app.js"></script><script crossorigin="anonymous" src="/foundation.js"></script><script crossorigin="anonymous" src="/lib.js"></script><script crossorigin="anonymous" src="/shared-pages_post_tsx.js"></script><script crossorigin="anonymous" src="/pages/post.js"></script></body></html>