<!DOCTYPE html><html><head><title>UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§</title><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1, user-scalable=no, viewport-fit=cover"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.5.0/themes/prism-vsc-dark-plus.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/toolbar/prism-toolbar.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-highlight/prism-line-highlight.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/material-icons@0.3.1/iconfont/material-icons.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/material-icons@0.3.1/css/material-icons.min.css"/><link rel="stylesheet" href="/outlet__outlets_default_tsx.css"/><link rel="stylesheet" href="/shared-outlets_index_scss.css"/><link rel="stylesheet" href="/pages/post.css"/></head><body><div id="__gadget__"><div><div class="" style="position:fixed;top:0;left:0;height:2px;background:transparent;z-index:99999999999;width:100%"><div style="height:100%;background:#2998ff;transition:all 500ms ease;width:0%"><div style="box-shadow:0 0 10px #2998ff, 0 0 10px #2998ff;width:5%;opacity:1;position:absolute;height:100%;transition:all 500ms ease;transform:rotate(3deg) translate(0px, -4px);left:-10rem"></div></div></div><div class="_3k0uOgdSRfNa0MZs6QS7ku"><div class="_1G63502GZaEXBXykcWz6cX">The hard ways</div><div class="_3HRY5_KLp8kngNq9437Zqi"><a href="/sitemap.html">all</a></div></div><div class="Z_a6ax5LrTSVASNRR2aN6 _11dH37BK8JkWofQgbOzM4L"><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>v8</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/v8/debug-v8-in-vscode.html"><i class=""></i><span>debug-v8-in-vscode</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/v8/common-data-types.html"><i class=""></i><span>v8 å¸¸è§æ•°æ®ç±»å‹</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>deno</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/deno/native-plugin.html"><i class=""></i><span>deno native plugin å†…éƒ¨å®ç°æœºåˆ¶</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>crypto</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/crypto/brief-crypto.html"><i class=""></i><span>åŠ å¯†ç®—æ³•è°ƒç ”</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>nodejs</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/Cluster æ¨¡å—åˆ†æ.html"><i class=""></i><span>Cluster æ¨¡å—åˆ†æ</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/build-from-source.html"><i class=""></i><span>build-from-source</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/node-addon.html"><i class=""></i><span>node-addon</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/common-snippet.html"><i class=""></i><span>common-snippet</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/heap-snapshot.html"><i class=""></i><span>v8 Heapsnapshot æ–‡ä»¶è§£æ</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/libuv.html"><i class=""></i><span>Libuv ä¹‹ - åªçœ‹è¿™ç¯‡æ˜¯ä¸å¤Ÿçš„</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/object-in-v8.html"><i class=""></i><span>Objects in V8</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/nodejs/node-on-libuv.html"><i class=""></i><span>Libuv ä¹‹ä¸Šçš„ Node</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>websocket</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/websocket/WebSocket åè®® 1~4 èŠ‚.html"><i class=""></i><span>WebSocket åè®® 1~4 èŠ‚</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/websocket/WebSocket åè®® 5~10 èŠ‚.html"><i class=""></i><span>WebSocket åè®® 5~10 èŠ‚</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>assembly</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/assembly/æ±‡ç¼–è¯­è¨€å­¦ä¹ å°ç»“.html"><i class=""></i><span>æ±‡ç¼–è¯­è¨€å­¦ä¹ å°ç»“</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>typescript</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/typescript/decorator.html"><i class=""></i><span>Decorator in babel and tsc</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>rust</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/rust/lifetime.html"><i class=""></i><span>Lifetime</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>oop</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/oop/ioc.html"><i class=""></i><span>midway åˆ†æ</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>php</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/php/ä¸ºä»€ä¹ˆ PHP ä¸é€‚åˆé•¿æ—¶é—´è¿è¡Œ.html"><i class=""></i><span>ä¸ºä»€ä¹ˆ PHP ä¸é€‚åˆé•¿æ—¶é—´è¿è¡Œ</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>blockchain</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/blockchain/crypto-conditions ç®€è¿°.html"><i class=""></i><span>crypto-conditions ç®€è¿°</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/blockchain/å®ç”¨æ‹œå åº­å®¹é”™ç®€ä»‹.html"><i class=""></i><span>å®ç”¨æ‹œå åº­å®¹é”™ç®€ä»‹</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>browser</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/browser/æµè§ˆå™¨å¼‚æ­¥åŠ è½½å’ŒåŒæºç­–ç•¥.html"><i class=""></i><span>æµè§ˆå™¨å¼‚æ­¥åŠ è½½å’ŒåŒæºç­–ç•¥</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>cpp</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/cpp/the-as-if-rule.html"><i class=""></i><span>The as-if rule</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>work</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/work/parsing-in-practice.html"><i class=""></i><span>Parsing in practice</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>os</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/os/å¤§å°ç«¯åº.html"><i class=""></i><span>å¤§å°ç«¯åº</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/os/UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§.html"><i class=""></i><span>UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/os/é­”æ•°0x7c00.html"><i class=""></i><span>é­”æ•° 0x7c00</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/os/å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç .html"><i class=""></i><span>å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç </span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>javascript</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/javascript/generator function.html"><i class=""></i><span>Generator Function</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/javascript/è§£æ JSON çš„æˆæœ¬.html"><i class=""></i><span>è§£æ JSON çš„æˆæœ¬</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/javascript/Javascript å†…éƒ¨çš„å­—ç¬¦ç¼–ç .html"><i class=""></i><span>Javascript å†…éƒ¨çš„å­—ç¬¦ç¼–ç </span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/javascript/é—­åŒ…çš„ä½œç”¨.html"><i class=""></i><span>é—­åŒ…çš„ä½œç”¨</span></a><ul></ul></div></li><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/javascript/é—­åŒ…æ˜¯ä»€ä¹ˆ.html"><i class=""></i><span>é—­åŒ…æ˜¯ä»€ä¹ˆ</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>static-analysis</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/static-analysis/ternjs.html"><i class=""></i><span>ä½¿ç”¨ Rust é‡å†™ ternjs</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>craft</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/craft/create_your_own_lang.html"><i class=""></i><span>åˆ¶ä½œä¸€ä¸ªå±äºè‡ªå·±çš„è¯­è¨€</span></a><ul></ul></div></li></ul></div><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><div class="_15sI_H5F3ci3xYIfWDB4vZ"><i class="mi mi-arrow-drop-down"></i><span>go</span></div><ul><li><div class="_3quX88R9lR5BSdfAKHIoaF _1lO9qEBu6kafjPHlc111Kf"><a class="_15sI_H5F3ci3xYIfWDB4vZ" style="padding-left:15px" href="/post/go/bad_in_generic_syntax.html"><i class=""></i><span>Go è¯­è¨€ä¸­çš„ Generic è®¾è®¡ç¼ºé™·</span></a><ul></ul></div></li></ul></div></div><div class="rWpFqfkPbEcRx8xnnjlEm line-numbers"><div><div><h2 id="ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥UTF-8ç¼–ç ">ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥ UTF-8 ç¼–ç </h2>
<p>æ ¹æ® WebSocket åè®®çš„è¦æ±‚ <a href="https://juejin.im/post/5c3ff7b5518825254c31a9a3#heading-9">5.6 æ•°æ®å¸§</a>ï¼Œå¦‚æœ Frame çš„ Opcode æ˜¯ <code>0x1</code> çš„è¯ï¼Œåˆ™è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å¸§ï¼Œå³å…¶ â€œApplication Dataâ€ æ˜¯ä½¿ç”¨ UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚ä¸è¿‡ç”±äºæ¶ˆæ¯ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ª Frame è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œæ‰€ä»¥åœ¨éªŒè¯æ–‡æœ¬æ¶ˆæ¯çš„ç¼–ç æ—¶ï¼Œéœ€è¦æ”¶é›†åˆ°æ¶ˆæ¯çš„æ‰€æœ‰ Frames åï¼Œæå–æ‰€æœ‰çš„ Frame ä¸­çš„ â€œApplication Dataâ€ ç»„æˆä¸€ä¸ªå¤§çš„  â€œApplication Dataâ€ï¼Œç„¶åéªŒè¯è¿™ä¸ªå¤§çš„  â€œApplication Dataâ€ ä¸­çš„å­—èŠ‚æ˜¯ä¸æ˜¯åˆæ³•çš„ UTF-8 ç¼–ç ã€‚</p>
<p>æ—¢ç„¶åè®®ä¸­è¦æ±‚äº†æ–‡æœ¬æ¶ˆæ¯å¿…é¡»ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œé‚£ä¹ˆåè¿‡æ¥ï¼ŒéªŒè¯ç¼–ç æ˜¯å¦æ˜¯ UTF-8å°±å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šç¡®å®šæ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚</p>
<h2 id=""><a href="https://zh.wikipedia.org/wiki/Unicode">Unicode</a></h2>
<p>ç®€å•çš„è¯´ Unicode å°±æ˜¯ä¸€ç§å­—ç¬¦çš„ç¼–ç æ–¹å¼ï¼Œæ­¤ç¼–ç æ–¹å¼ä¸€èˆ¬ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼ˆ<a href="https://en.wikipedia.org/wiki/Universal_Coded_Character_Set">UCS-2</a>ï¼‰å»è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚â€œæ±‰â€è¿™ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œå…¶ unicode ç¼–ç çš„åå…­è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ <code>0x6c49</code>ã€‚</p>
<h2 id=""><a href="https://zh.wikipedia.org/wiki/UTF-8">UTF-8</a></h2>
<p>UTF-8 çš„å…¨ç§°æ˜¯ <strong>8-bit Unicode Transformation Format</strong> ä¸­æ–‡å°±æ˜¯ â€œ8 ä½çš„ unicode è½¬æ¢æ ¼å¼â€ã€‚UTF-8 æ˜¯å…·ä½“çš„ Unicode å®ç°æ–¹å¼ä¸­çš„ä¸€ç§ï¼Œå¥—ç”¨ wiki ä¸Šçš„ä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>ä½†æ˜¯åœ¨å®é™…ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œç”±äºä¸åŒ<a href="https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E5%B9%B3%E5%8F%B0">ç³»ç»Ÿå¹³å°</a>çš„è®¾è®¡ä¸ä¸€å®šä¸€è‡´ï¼Œä»¥åŠå‡ºäºèŠ‚çœç©ºé—´çš„ç›®çš„ï¼Œå¯¹Unicodeç¼–ç çš„å®ç°æ–¹å¼æœ‰æ‰€ä¸åŒã€‚Unicodeçš„å®ç°æ–¹å¼ç§°ä¸º<strong>Unicodeè½¬æ¢æ ¼å¼</strong>ï¼ˆUnicode Transformation Formatï¼Œç®€ç§°ä¸ºUTFï¼‰</p>
</blockquote>
<h2 id="UTF-8çš„ç¼–ç æ–¹å¼">UTF-8 çš„ç¼–ç æ–¹å¼</h2>
<blockquote>
<p>UTF-8ä½¿ç”¨ä¸€è‡³å…­ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç ï¼ˆå°½ç®¡å¦‚æ­¤ï¼Œ2003å¹´11æœˆUTF-8è¢«<a href="https://tools.ietf.org/html/rfc3629">RFC 3629</a>é‡æ–°è§„èŒƒï¼Œåªèƒ½ä½¿ç”¨åŸæ¥Unicodeå®šä¹‰çš„åŒºåŸŸï¼ŒU+0000åˆ°U+10FFFFï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šå››ä¸ªå­—èŠ‚ï¼‰</p>
</blockquote>
<pre><code>   Char. number range  |        UTF-8 octet sequence
      (hexadecimal)    |              (binary)
   --------------------+---------------------------------------------
   0000 0000-0000 007F | 0xxxxxxx
   0000 0080-0000 07FF | 110xxxxx 10xxxxxx
   0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
   0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
</code></pre>
<ul>
<li>å¯¹äº UTF-8 ç¼–ç ä¸­çš„ä»»æ„å­—èŠ‚Bï¼Œå¦‚æœBçš„ç¬¬ä¸€ä½ä¸º0ï¼Œåˆ™Bä¸ºASCIIç ï¼Œå¹¶ä¸”Bç‹¬ç«‹çš„è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼›</li>
<li>å¦‚æœBçš„ç¬¬ä¸€ä½ä¸º1ï¼Œç¬¬äºŒä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”ä¸æ˜¯å­—ç¬¦çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ç¼–ç ï¼›</li>
<li>å¦‚æœBçš„å‰ä¸¤ä½ä¸º1ï¼Œç¬¬ä¸‰ä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ç”±ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼›</li>
<li>å¦‚æœBçš„å‰ä¸‰ä½ä¸º1ï¼Œç¬¬å››ä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ç”±ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºï¼›</li>
<li>å¦‚æœBçš„å‰å››ä½ä¸º1ï¼Œç¬¬äº”ä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ç”±å››ä¸ªå­—èŠ‚è¡¨ç¤ºï¼›</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…¼å®¹æœ€æ–°çš„æ ‡å‡†å³å¯ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰æ˜ç™½ UTF-8 ç¼–ç çš„å«ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ¯”å¦‚ä¸­æ–‡çš„ â€œæ±‰â€ï¼Œå…¶ Unicode ç¼–ç çš„åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ <code>0x6c49</code>ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾ï¼Œå®ƒå¿…ç„¶è½åœ¨ <code>0x00000800 â€“ 0x0000FFFF</code> è¿™ä¸ªåŒºé—´å†…ï¼Œè€Œè¿™ä¸ªåŒºé—´çš„å­—ç¬¦å¿…é¡»ä½¿ç”¨ 3 ä¸ªå­—èŠ‚çš„ UTF-8 ç¼–ç ï¼Œè¡¨ç¤ºæˆ <code>1110xxxx 10xxxxxx 10xxxxxx</code> çš„å½¢å¼ã€‚</p>
<p>æ‰€ä»¥å¯¹äº <code>0x6c49</code> è¦è½¬æˆ UTF-8 ç¼–ç ï¼š</p>
<ol>
<li>å°† <code>0x6c49</code> å³ç§» 12 ä½ï¼Œå–å‡ºæœ€é«˜çš„ 4 ä½ï¼Œç„¶åæˆ–ä¸Š <code>11100000</code>ï¼ˆå³ <code>0xE0</code>ï¼‰ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚ <code>0xE6</code></li>
<li>å°† <code>0x6c49</code> ä¸ä¸Š <code>0000111111000000</code>ï¼ˆå³ <code>0xFC0</code>ï¼‰ åã€å³ç§» 6 ä½ï¼Œè¿™æ ·å¾—åˆ°ä¸­é—´çš„ 6 ä½ï¼Œç„¶åæˆ–ä¸Š <code>10000000</code>ï¼ˆå³ <code>0x80</code>ï¼‰ å¾—åˆ°ç¬¬äºŒä¸ªå­—èŠ‚ <code>0xB1</code></li>
<li>å°† <code>0x6c49</code> ä¸ä¸Š <code>0000000000111111</code>ï¼ˆå³ <code>0x3F</code>ï¼‰ åï¼Œæˆ–ä¸Š <code>10000000</code>ï¼ˆå³ <code>0x80</code>ï¼‰ å¾—åˆ°ç¬¬ä¸‰ä¸ªå­—èŠ‚ <code>0x89</code></li>
</ol>
<p>äºæ˜¯ä¸­æ–‡å­—ç¬¦ â€œæ±‰â€ çš„ UTF-8 ç¼–ç å°±æ˜¯ <code>0xE6 0xB1 0x89</code>ï¼Œæ˜¯ä¸æ˜¯ so easyã€‚</p>
<p>ç°åœ¨ï¼Œå‡è®¾ç°åœ¨æˆ‘ä»¬å¾—åˆ°ä¸€ä¸²æ•°æ®ï¼Œå®ƒåŒ…å« 3 ä¸ªå­—èŠ‚ï¼Œå…¶å†…å®¹æ˜¯ <code>0xE6 0xB1 0x89</code>ï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“è¿™ä¸²æ•°æ®é‡‡ç”¨çš„æ˜¯ UTF-8 ç¼–ç ï¼Œæˆ‘ä»¬æ€ä¹ˆå¾—çŸ¥å…¶å¯¹åº”çš„ unicode ç¼–ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸€ç§ä¸€ç§çš„æƒ…å†µè¯•å•Šï¼</p>
<ol>
<li>å–å‡ºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œæ£€æŸ¥å…¶æœ€é«˜ä½æ˜¯ä¸æ˜¯ 0ï¼Œå¦‚æœæ˜¯0ï¼Œé‚£ä¹ˆå½“å‰å­—èŠ‚å³è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥</li>
<li>æ£€æŸ¥æœ€é«˜ 3 ä½æ˜¯ä¸æ˜¯ <code>110</code>ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸€ä¸ªå­—èŠ‚å’Œå½“å‰å­—èŠ‚åˆèµ·æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥</li>
<li>æ£€æŸ¥æœ€é«˜ 4 ä½æ˜¯ä¸æ˜¯ <code>1110</code>ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸¤ä¸ªå­—èŠ‚å’Œå½“å‰å­—èŠ‚åˆèµ·æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥</li>
<li>æ£€æŸ¥æœ€é«˜ 5 ä½æ˜¯ä¸æ˜¯ <code>11110</code>ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸‰ä¸ªå­—èŠ‚å’Œå½“å‰å­—èŠ‚åˆèµ·æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥</li>
<li>æ ¹æ®æœ€æ–°çš„æ ‡å‡†ï¼ŒUTF-8 ç¼–ç æœ€å¤šåªä½¿ç”¨å››ä¸ªå­—èŠ‚å»è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥åˆ°äº†è¿™ä¸€æ­¥å°±è¯´æ˜ç¼–ç é”™è¯¯äº†</li>
<li>å¦å¤–é™¤äº†è¡¨ç¤ºå‰©ä½™å­—èŠ‚æ•°çš„é‚£ä¸ªå­—èŠ‚å¤–ï¼Œå…¶ä½™å­—èŠ‚çš„æœ€é«˜ä¸¤ä½éƒ½å¿…é¡»æ˜¯ <code>10</code></li>
<li><code>U+0000</code> ä¸å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç </li>
<li><code>U+D800~U+DFFF</code> ï¼ˆå·¦å³è¾¹ç•Œä¸å¯å–ï¼‰æ˜¯ä¿ç•™æ®µï¼Œä¸å¯ä»¥ä½¿ç”¨</li>
</ol>
<p>é‚£ä¹ˆçœ‹çœ‹åˆšæ‰çš„ä¾‹å­ï¼Œæˆ‘ä»¬å–å‡ºç¬¬ä¸€ä¸ªå­—èŠ‚ <code>0xE6</code>ï¼ˆå³ <code>1110 0110</code>ï¼‰ï¼Œæˆ‘è¦é€ä¸€çš„å°è¯•æ¯ä¸€ç§æƒ…å†µï¼Œæœ€åæˆ‘ä»¬å‘ç°å®ƒçš„æœ€é«˜ 4 ä½æ˜¯ <code>1110</code> é‚£ä¹ˆå®ƒä¹‹åçš„ä¸¤ä¸ªå­—èŠ‚å’Œå®ƒä¸€èµ·è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚</p>
<ol>
<li>é¦–å…ˆæˆ‘ä»¬å…ˆå°†ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ä¸Š <code>0xF</code>ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å®é™…çš„ 4 ä½</li>
<li>å–å‡ºç´§éšçš„ç¬¬äºŒä¸ªå­—èŠ‚ï¼Œå°†å…¶ä¸ä¸Š <code>0x3F</code>ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å®é™…çš„ 6 ä½</li>
<li>å–å‡ºç´§éšçš„ç¬¬ä¸‰ä¸ªå­—èŠ‚ï¼Œå°†å…¶ä¸ä¸Š <code>0x3F</code>ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å®é™…çš„ 6 ä½</li>
</ol>
<p>æœ€åå°†è¿™ 16 ä¸ªæ•°ä½æŒ‰ç…§å–å‡ºçš„é¡ºåºä»å·¦å¾€å³æ”¾å­˜æ”¾åˆ°ä¸‰ä¸ªå­—èŠ‚ä¸­ã€‚</p>
<h2 id="ä»£ç ">ä»£ç </h2>
<p>å…ˆæ”¾ javascript çš„ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨äº† ES6 ä¸­çš„ <code>String.prototype.codePointAt</code> æ–¹æ³•ï¼Œå› ä¸ºåœ¨ ES5 ä¸­å¯¹äºè¶…è¿‡äº† <code>0xFFFF</code> çš„å­—ç¬¦ä½¿ç”¨ <code>String.prototype.charCodeAt</code> å¹¶ä¸èƒ½æ­£ç¡®çš„è·å–å…¶ unicode ç¼–ç :</p>
<pre><code class="language-js">&quot;use strict&quot;;

console.assert(typeof String.prototype.codePointAt == &#x27;function&#x27;, &quot;Current env doesn&#x27;t support ECMAScript 6!&quot;);

Array.prototype.equal = function (b) {
    return this.every(function (e, i) {
        return e === b[i];
    });
};

var unicode2utf8 = function (unicode) {
    unicode = typeof unicode == &#x27;string&#x27; ? unicode.codePointAt(0) : unicode;

    if (unicode &lt;= 0x7F) {
        return [unicode]
    } else if (unicode &gt;= 0x80 &amp;&amp; unicode &lt;= 0x7FF) {
        return [
            unicode &gt;&gt; 6 | 0xC0,
            unicode &amp; 0x3F | 0x80
        ];
    } else if (unicode &gt;= 0x800 &amp;&amp; unicode &lt;= 0xFFFF) {
        return [
            unicode &gt;&gt; 12 | 0xE0,
            (unicode &amp; 0xFC0) &gt;&gt; 6 | 0x80,
            unicode &amp; 0x3F | 0x80
        ];
    } else if (unicode &gt;= 0x10000 &amp;&amp; unicode &lt;= 0x10FFFF) {
        return [
            unicode &gt;&gt; 18 | 0xF0,
            (unicode &amp; 0x3F000) &gt;&gt; 12 | 0x80,
            (unicode &amp; 0xFC0) &gt;&gt; 6 | 0x80,
            unicode &amp; 0x3F | 0x80
        ];
    } else {
        throw new Error(&#x27;deformed unicode: &#x27; + unicode);
    }
};

console.assert(unicode2utf8(&#x27;u&#x27;).equal([0x75]), &quot;unicode2utf8 not pass &#x27;u&#x27;&quot;);
console.assert(unicode2utf8(&#x27;Â©&#x27;).equal([0xC2, 0xA9]), &quot;unicode2utf8 not pass &#x27;Â©&#x27;&quot;);
console.assert(unicode2utf8(&#x27;æ±‰&#x27;).equal([0xE6, 0xB1, 0x89]), &quot;unicode2utf8 not pass &#x27;æ±‰&#x27;&quot;);
console.assert(unicode2utf8(&#x27;ğŸ˜„&#x27;).equal([0xF0, 0x9F, 0x98, 0x84]), &quot;unicode2utf8 not pass &#x27;ğŸ˜„&#x27;&quot;);

var utf82unicode = function (utf8) {
    var ul = utf8.length, byte = utf8[0];

    if (ul == 0) {
        throw new Error(&#x27;empty utf8&#x27;);
    }

    if (byte &lt;= 127) {
        return byte;
    } else if (byte &gt;&gt; 5 == 0x6 &amp;&amp; ul == 2) {
        return ((byte &amp; 0x1F) &lt;&lt; 6) |
                utf8[1] &amp; 0x3F;
    } else if (byte &gt;&gt; 4 == 0xE &amp;&amp; ul == 3) {
        return ((byte &amp; 0xF) &lt;&lt; 12) |
                ((utf8[1] &amp; 0x3F) &lt;&lt; 6) |
                (utf8[2] &amp; 0x3F)
    } else if (byte &gt;&gt; 3 == 0x1E &amp;&amp; ul == 4) {
        return ((byte &amp; 0x7) &lt;&lt; 18) |
                ((utf8[1] &amp; 0x3F) &lt;&lt; 12) |
                ((utf8[2] &amp; 0x3F) &lt;&lt; 6) |
                (utf8[3] &amp; 0x3F)
    } else {
        throw new Error(&#x27;deformed utf8: &#x27; + utf8);
    }
};

console.assert(utf82unicode([0x75]) == &#x27;u&#x27;.codePointAt(0), &quot;utf82unicode not pass &#x27;u&#x27;&quot;);
console.assert(utf82unicode([0xC2, 0xA9]) == &#x27;Â©&#x27;.codePointAt(0), &quot;utf82unicode not pass &#x27;Â©&#x27;&quot;);
console.assert(utf82unicode([0xE6, 0xB1, 0x89]) == &#x27;æ±‰&#x27;.codePointAt(0), &quot;utf82unicode not pass &#x27;æ±‰&#x27;&quot;);
console.assert(utf82unicode([0xF0, 0x9F, 0x98, 0x84]) == &#x27;ğŸ˜„&#x27;.codePointAt(0), &quot;utf82unicode not pass &#x27;ğŸ˜„&#x27;&quot;);
</code></pre>
<p>æ¥ä¸‹æ¥æ˜¯ golang çš„ï¼Œå…¶ä¸­çš„ <code>IsIntactUtf8</code> å‡½æ•°å°±æ˜¯æœ¬æ–‡è®¨è®ºçš„ä¸»é¢˜ - æ£€æŸ¥UTF-8ç¼–ç çš„å®Œæ•´æ€§ï¼š</p>
<pre><code class="language-go">func Unicode2utf8(u uint32) (u8 []byte, err error) {
	if u &lt;= 0x7F {
		return []byte{byte(u)}, nil
	} else if u &gt;= 0x80 &amp;&amp; u &lt;= 0x7FF {
		return []byte{
			byte(u&gt;&gt;6 | 0xC0),
			byte(u&amp;0x3F | 0x80),
		}, nil
	} else if u &gt;= 0x800 &amp;&amp; u &lt;= 0xFFFF {
		return []byte{
			byte(u&gt;&gt;12 | 0xE0),
			byte((u&amp;0xFC0)&gt;&gt;6 | 0x80),
			byte(u&amp;0x3F | 0x80),
		}, nil
	} else if u &gt;= 0x10000 &amp;&amp; u &lt;= 0x10FFFF {
		return []byte{
			byte(u&gt;&gt;18 | 0xF0),
			byte((u&amp;0x3F000)&gt;&gt;12 | 0x80),
			byte((u&amp;0xFC0)&gt;&gt;6 | 0x80),
			byte(u&amp;0x3F | 0x80),
		}, nil
	}

	return nil, errors.New(fmt.Sprintf(&quot;deformed unicode: %d&quot;, u))
}

func TestUnicode2utf8(t *testing.T) {
	u8, _ := Unicode2utf8(0x75)
	if !reflect.DeepEqual(u8, []byte{0x75}) {
		t.Fatal(&quot;not pass &#x27;u&#x27;&quot;)
	}

	u8, _ = Unicode2utf8(0xA9)
	if !reflect.DeepEqual(u8, []byte{0xC2, 0xA9}) {
		t.Fatal(&quot;not pass &#x27;Â©&#x27;&quot;)
	}

	u8, _ = Unicode2utf8(0x6C49)
	if !reflect.DeepEqual(u8, []byte{0xE6, 0xB1, 0x89}) {
		t.Fatal(&quot;not pass &#x27;æ±‰&#x27;&quot;)
	}

	u8, _ = Unicode2utf8(0x1F604)
	if !reflect.DeepEqual(u8, []byte{0xF0, 0x9F, 0x98, 0x84}) {
		t.Fatal(&quot;not pass &#x27;ğŸ˜„&#x27;&quot;)
	}
}

func Utf82unicode(u8 []byte) (u uint32, err error) {
	u8l := len(u8)

	if u8l == 0 {
		return 0, errors.New(&quot;empty utf8&quot;)
	}

	b1 := u8[0]
	if b1 &lt;= 0x7F {
		return uint32(b1), nil
	} else if b1&gt;&gt;5 == 0x6 &amp;&amp; u8l == 2 {
		return uint32(b1&amp;0x1F)&lt;&lt;6 |
			uint32(u8[1]&amp;0x3F), nil
	} else if b1&gt;&gt;4 == 0xE &amp;&amp; u8l == 3 {
		return uint32(b1&amp;0xF)&lt;&lt;12 |
			uint32(u8[1]&amp;0x3F)&lt;&lt;6 |
			uint32(u8[2]&amp;0x3F), nil

	} else if b1&gt;&gt;3 == 0x1E &amp;&amp; u8l == 4 {
		return uint32(b1&amp;0x7)&lt;&lt;18 |
			uint32(u8[1]&amp;0x3F)&lt;&lt;12 |
			uint32(u8[2]&amp;0x3F)&lt;&lt;6 |
			uint32(u8[3]&amp;0x3F), nil
	}

	return 0, errors.New(fmt.Sprintf(&quot;deformed utf8: %d&quot;, u8))
}

func TestUtf82unicode(t *testing.T) {
	u, _ := Utf82unicode([]byte{0x75})
	if u != 0x75 {
		t.Fatal(&quot;not pass &#x27;u&#x27;&quot;)
	}

	u, _ = Utf82unicode([]byte{0xC2, 0xA9})
	if u != 0xA9 {
		t.Fatal(&quot;not pass &#x27;Â©&#x27;&quot;)
	}

	u, _ = Utf82unicode([]byte{0xE6, 0xB1, 0x89})
	if u != 0x6C49 {
		t.Fatalf(&quot;not pass &#x27;æ±‰&#x27;: %x&quot;, u)
	}

	u, _ = Utf82unicode([]byte{0xF0, 0x9F, 0x98, 0x84})
	if u != 0x1F604 {
		t.Fatal(&quot;not pass &#x27;ğŸ˜„&#x27;&quot;)
	}
}

func IsIntactUtf8(u8 []byte) bool {
	i := 0
	u8l := len(u8)

	for {
		if i == u8l {
			break
		}

		b1 := u8[i]
		var tu uint32

		switch {
		case b1 &lt;= 0x7F:
		case b1&gt;&gt;5 == 0x6:
			if u8l-i &gt;= 2 &amp;&amp;
				u8[i+1]&amp;0xC0 == 0x80 &amp;&amp;
				// U+0000 encoded in two bytes: incorrect
				(u8[i] &gt; 0xC0 || u8[i+1] &gt; 0x80) {
				i++
			} else {
				return false
			}
		case b1&gt;&gt;4 == 0xE:
			if u8l-i &gt;= 3 {
				tu = uint32(b1&amp;0xF)&lt;&lt;12 |
					uint32(u8[i+1]&amp;0x3F)&lt;&lt;6 |
					uint32(u8[i+2]&amp;0x3F)

				// UTF-8 prohibits encoding character numbers between U+D800 and U+DFFF
				if tu &gt;= 0x800 &amp;&amp; tu &lt;= 0xFFFF &amp;&amp; !(tu &gt;= 0xD800 &amp;&amp; tu &lt;= 0xDFFF) {
					i += 2
				} else {
					return false
				}
			} else {
				return false
			}
		case b1&gt;&gt;3 == 0x1E:
			if u8l-i &gt;= 4 &amp;&amp;
				u8[i]&amp;0x7 &lt;= 0x4 &amp;&amp;
				u8[i+1]&amp;0xC0 == 0x80 &amp;&amp; u8[i+1]&amp;0x3F &lt;= 0xF &amp;&amp;
				u8[i+2]&amp;0xC0 == 0x80 &amp;&amp;
				u8[i+3]&amp;0xC0 == 0x80 {
				i += 3
			} else {
				return false
			}
		default:
			return false
		}
		i++
	}

	return i == u8l
}

type ValidTest struct {
	in  string
	out bool
}

var validTests = []ValidTest{
	{&quot;&quot;, true},
	{&quot;a&quot;, true},
	{&quot;abc&quot;, true},
	{&quot;Ğ–&quot;, true},
	{&quot;Ğ–Ğ–&quot;, true},
	{&quot;Ğ±Ñ€ÑĞ´-Ğ›Ğ“Ğ¢Ğœ&quot;, true},
	{&quot;â˜ºâ˜»â˜¹&quot;, true},
	{string([]byte{66, 250}), false},
	{string([]byte{66, 250, 67}), false},
	{&quot;a\uFFFDb&quot;, true},
	{string(&quot;\xF4\x8F\xBF\xBF&quot;), true},      // U+10FFFF
	{string(&quot;\xF4\x90\x80\x80&quot;), false},     // U+10FFFF+1; out of range
	{string(&quot;\xF7\xBF\xBF\xBF&quot;), false},     // 0x1FFFFF; out of range
	{string(&quot;\xFB\xBF\xBF\xBF\xBF&quot;), false}, // 0x3FFFFFF; out of range
	{string(&quot;\xc0\x80&quot;), false},             // U+0000 encoded in two bytes: incorrect
	{string(&quot;\xed\xa0\x80&quot;), false},         // U+D800 high surrogate (sic)
	{string(&quot;\xed\xbf\xbf&quot;), false},         // U+DFFF low surrogate (sic)
}

func TestIsIntactUtf8(t *testing.T) {
	for i, tt := range validTests {
		if IsIntactUtf8([]byte(tt.in)) != tt.out {
			t.Fatalf(&quot;[CASE %d] IsIntactUtf8(%q) = %v; want %v&quot;, i, tt.in, !tt.out, tt.out)
		}
	}
}
</code></pre>
<p>åŸç†ä»¥åŠä»£ç éƒ½ç»™å‡ºæ¥äº†ï¼Œåº”è¯¥ä¼šå¯¹ UTF-8 ä»¥åŠ UTF-8 ä¸ Unicode ä¹‹é—´çš„å…³ç³»ä¸æ˜äº†çš„åŒå­¦æœ‰äº›å¸®åŠ©å§ã€‚</p></div></div></div><div class="_3a4jt6lr4yLRJnQge009wv"><ul><li><div class="pr9M2Qxu3rP9KbtpZMUZy"><div class="_3BS2IRzowIlPVoY1ThvbNb"><span><a class="" href="#ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥UTF-8ç¼–ç ">ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥ UTF-8 ç¼–ç </a></span></div><ul></ul></div></li><li><div class="pr9M2Qxu3rP9KbtpZMUZy"><div class="_3BS2IRzowIlPVoY1ThvbNb"><span><a class="" href="#"></a></span></div><ul></ul></div></li><li><div class="pr9M2Qxu3rP9KbtpZMUZy"><div class="_3BS2IRzowIlPVoY1ThvbNb"><span><a class="" href="#"></a></span></div><ul></ul></div></li><li><div class="pr9M2Qxu3rP9KbtpZMUZy"><div class="_3BS2IRzowIlPVoY1ThvbNb"><span><a class="" href="#UTF-8çš„ç¼–ç æ–¹å¼">UTF-8 çš„ç¼–ç æ–¹å¼</a></span></div><ul></ul></div></li><li><div class="pr9M2Qxu3rP9KbtpZMUZy"><div class="_3BS2IRzowIlPVoY1ThvbNb"><span><a class="" href="#ä»£ç ">ä»£ç </a></span></div><ul></ul></div></li></ul></div><div class="_1UY_ItV2UTWKutKs5b7NKg">Made with <a target="_blank" href="https://github.com/hsiaosiyuan0/gadget">gadget</a></div></div></div><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-core.min.js" data-manual="true"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-markup.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-clike.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-json.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-javascript.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-jsx.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-typescript.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-tsx.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-bash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-python.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-xml-doc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-docker.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-rust.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-nasm.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-c.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-cpp.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-xml-doc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-go.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-highlight/prism-line-highlight.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@5.1.1/dist/gumshoe.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react@16.14.0/umd/react.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-dom@16.14.0/umd/react-dom.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react@16.14.0/umd/react.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-dom@16.14.0/umd/react-dom.production.min.js"></script><script>window["__gadget__"]={"initialProps":{"data":{"post":{"filename":"UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§","rawMeta":{"title":"UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§"},"content":"## ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥ UTF-8 ç¼–ç \n\næ ¹æ® WebSocket åè®®çš„è¦æ±‚ [5.6 æ•°æ®å¸§](https://juejin.im/post/5c3ff7b5518825254c31a9a3#heading-9)ï¼Œå¦‚æœ Frame çš„ Opcode æ˜¯ `0x1` çš„è¯ï¼Œåˆ™è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å¸§ï¼Œå³å…¶ â€œApplication Dataâ€ æ˜¯ä½¿ç”¨ UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚ä¸è¿‡ç”±äºæ¶ˆæ¯ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ª Frame è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œæ‰€ä»¥åœ¨éªŒè¯æ–‡æœ¬æ¶ˆæ¯çš„ç¼–ç æ—¶ï¼Œéœ€è¦æ”¶é›†åˆ°æ¶ˆæ¯çš„æ‰€æœ‰ Frames åï¼Œæå–æ‰€æœ‰çš„ Frame ä¸­çš„ â€œApplication Dataâ€ ç»„æˆä¸€ä¸ªå¤§çš„  â€œApplication Dataâ€ï¼Œç„¶åéªŒè¯è¿™ä¸ªå¤§çš„  â€œApplication Dataâ€ ä¸­çš„å­—èŠ‚æ˜¯ä¸æ˜¯åˆæ³•çš„ UTF-8 ç¼–ç ã€‚\n\næ—¢ç„¶åè®®ä¸­è¦æ±‚äº†æ–‡æœ¬æ¶ˆæ¯å¿…é¡»ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œé‚£ä¹ˆåè¿‡æ¥ï¼ŒéªŒè¯ç¼–ç æ˜¯å¦æ˜¯ UTF-8å°±å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šç¡®å®šæ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚\n\n## [Unicode](https://zh.wikipedia.org/wiki/Unicode)\nç®€å•çš„è¯´ Unicode å°±æ˜¯ä¸€ç§å­—ç¬¦çš„ç¼–ç æ–¹å¼ï¼Œæ­¤ç¼–ç æ–¹å¼ä¸€èˆ¬ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼ˆ[UCS-2](https://en.wikipedia.org/wiki/Universal_Coded_Character_Set)ï¼‰å»è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚â€œæ±‰â€è¿™ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œå…¶ unicode ç¼–ç çš„åå…­è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ `0x6c49`ã€‚\n\n## [UTF-8](https://zh.wikipedia.org/wiki/UTF-8)\nUTF-8 çš„å…¨ç§°æ˜¯ **8-bit Unicode Transformation Format** ä¸­æ–‡å°±æ˜¯ â€œ8 ä½çš„ unicode è½¬æ¢æ ¼å¼â€ã€‚UTF-8 æ˜¯å…·ä½“çš„ Unicode å®ç°æ–¹å¼ä¸­çš„ä¸€ç§ï¼Œå¥—ç”¨ wiki ä¸Šçš„ä¸€æ®µè¯ï¼š\n\n>ä½†æ˜¯åœ¨å®é™…ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œç”±äºä¸åŒ[ç³»ç»Ÿå¹³å°](https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E5%B9%B3%E5%8F%B0)çš„è®¾è®¡ä¸ä¸€å®šä¸€è‡´ï¼Œä»¥åŠå‡ºäºèŠ‚çœç©ºé—´çš„ç›®çš„ï¼Œå¯¹Unicodeç¼–ç çš„å®ç°æ–¹å¼æœ‰æ‰€ä¸åŒã€‚Unicodeçš„å®ç°æ–¹å¼ç§°ä¸º**Unicodeè½¬æ¢æ ¼å¼**ï¼ˆUnicode Transformation Formatï¼Œç®€ç§°ä¸ºUTFï¼‰\n\n## UTF-8 çš„ç¼–ç æ–¹å¼\n\n>UTF-8ä½¿ç”¨ä¸€è‡³å…­ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç ï¼ˆå°½ç®¡å¦‚æ­¤ï¼Œ2003å¹´11æœˆUTF-8è¢«[RFC 3629](https://tools.ietf.org/html/rfc3629)é‡æ–°è§„èŒƒï¼Œåªèƒ½ä½¿ç”¨åŸæ¥Unicodeå®šä¹‰çš„åŒºåŸŸï¼ŒU+0000åˆ°U+10FFFFï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šå››ä¸ªå­—èŠ‚ï¼‰\n\n```\n   Char. number range  |        UTF-8 octet sequence\n      (hexadecimal)    |              (binary)\n   --------------------+---------------------------------------------\n   0000 0000-0000 007F | 0xxxxxxx\n   0000 0080-0000 07FF | 110xxxxx 10xxxxxx\n   0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx\n   0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n```\n\n* å¯¹äº UTF-8 ç¼–ç ä¸­çš„ä»»æ„å­—èŠ‚Bï¼Œå¦‚æœBçš„ç¬¬ä¸€ä½ä¸º0ï¼Œåˆ™Bä¸ºASCIIç ï¼Œå¹¶ä¸”Bç‹¬ç«‹çš„è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼›\n* å¦‚æœBçš„ç¬¬ä¸€ä½ä¸º1ï¼Œç¬¬äºŒä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”ä¸æ˜¯å­—ç¬¦çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ç¼–ç ï¼›\n* å¦‚æœBçš„å‰ä¸¤ä½ä¸º1ï¼Œç¬¬ä¸‰ä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ç”±ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼›\n* å¦‚æœBçš„å‰ä¸‰ä½ä¸º1ï¼Œç¬¬å››ä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ç”±ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºï¼›\n* å¦‚æœBçš„å‰å››ä½ä¸º1ï¼Œç¬¬äº”ä½ä¸º0ï¼Œåˆ™Bä¸ºä¸€ä¸ªéASCIIå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ç”±å››ä¸ªå­—èŠ‚è¡¨ç¤ºï¼›\n\næ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…¼å®¹æœ€æ–°çš„æ ‡å‡†å³å¯ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰æ˜ç™½ UTF-8 ç¼–ç çš„å«ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ¯”å¦‚ä¸­æ–‡çš„ â€œæ±‰â€ï¼Œå…¶ Unicode ç¼–ç çš„åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ `0x6c49`ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾ï¼Œå®ƒå¿…ç„¶è½åœ¨ `0x00000800 â€“ 0x0000FFFF` è¿™ä¸ªåŒºé—´å†…ï¼Œè€Œè¿™ä¸ªåŒºé—´çš„å­—ç¬¦å¿…é¡»ä½¿ç”¨ 3 ä¸ªå­—èŠ‚çš„ UTF-8 ç¼–ç ï¼Œè¡¨ç¤ºæˆ `1110xxxx 10xxxxxx 10xxxxxx` çš„å½¢å¼ã€‚\n\næ‰€ä»¥å¯¹äº `0x6c49` è¦è½¬æˆ UTF-8 ç¼–ç ï¼š\n1. å°† `0x6c49` å³ç§» 12 ä½ï¼Œå–å‡ºæœ€é«˜çš„ 4 ä½ï¼Œç„¶åæˆ–ä¸Š `11100000`ï¼ˆå³ `0xE0`ï¼‰ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚ `0xE6`\n2. å°† `0x6c49` ä¸ä¸Š `0000111111000000`ï¼ˆå³ `0xFC0`ï¼‰ åã€å³ç§» 6 ä½ï¼Œè¿™æ ·å¾—åˆ°ä¸­é—´çš„ 6 ä½ï¼Œç„¶åæˆ–ä¸Š `10000000`ï¼ˆå³ `0x80`ï¼‰ å¾—åˆ°ç¬¬äºŒä¸ªå­—èŠ‚ `0xB1`\n3. å°† `0x6c49` ä¸ä¸Š `0000000000111111`ï¼ˆå³ `0x3F`ï¼‰ åï¼Œæˆ–ä¸Š `10000000`ï¼ˆå³ `0x80`ï¼‰ å¾—åˆ°ç¬¬ä¸‰ä¸ªå­—èŠ‚ `0x89`\n\näºæ˜¯ä¸­æ–‡å­—ç¬¦ â€œæ±‰â€ çš„ UTF-8 ç¼–ç å°±æ˜¯ `0xE6 0xB1 0x89`ï¼Œæ˜¯ä¸æ˜¯ so easyã€‚\n\nç°åœ¨ï¼Œå‡è®¾ç°åœ¨æˆ‘ä»¬å¾—åˆ°ä¸€ä¸²æ•°æ®ï¼Œå®ƒåŒ…å« 3 ä¸ªå­—èŠ‚ï¼Œå…¶å†…å®¹æ˜¯ `0xE6 0xB1 0x89`ï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“è¿™ä¸²æ•°æ®é‡‡ç”¨çš„æ˜¯ UTF-8 ç¼–ç ï¼Œæˆ‘ä»¬æ€ä¹ˆå¾—çŸ¥å…¶å¯¹åº”çš„ unicode ç¼–ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸€ç§ä¸€ç§çš„æƒ…å†µè¯•å•Šï¼\n\n1. å–å‡ºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œæ£€æŸ¥å…¶æœ€é«˜ä½æ˜¯ä¸æ˜¯ 0ï¼Œå¦‚æœæ˜¯0ï¼Œé‚£ä¹ˆå½“å‰å­—èŠ‚å³è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥\n2. æ£€æŸ¥æœ€é«˜ 3 ä½æ˜¯ä¸æ˜¯ `110`ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸€ä¸ªå­—èŠ‚å’Œå½“å‰å­—èŠ‚åˆèµ·æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥\n3. æ£€æŸ¥æœ€é«˜ 4 ä½æ˜¯ä¸æ˜¯ `1110`ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸¤ä¸ªå­—èŠ‚å’Œå½“å‰å­—èŠ‚åˆèµ·æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥\n4. æ£€æŸ¥æœ€é«˜ 5 ä½æ˜¯ä¸æ˜¯ `11110`ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸‰ä¸ªå­—èŠ‚å’Œå½“å‰å­—èŠ‚åˆèµ·æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥\n5. æ ¹æ®æœ€æ–°çš„æ ‡å‡†ï¼ŒUTF-8 ç¼–ç æœ€å¤šåªä½¿ç”¨å››ä¸ªå­—èŠ‚å»è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥åˆ°äº†è¿™ä¸€æ­¥å°±è¯´æ˜ç¼–ç é”™è¯¯äº†\n6. å¦å¤–é™¤äº†è¡¨ç¤ºå‰©ä½™å­—èŠ‚æ•°çš„é‚£ä¸ªå­—èŠ‚å¤–ï¼Œå…¶ä½™å­—èŠ‚çš„æœ€é«˜ä¸¤ä½éƒ½å¿…é¡»æ˜¯ `10`\n7. `U+0000` ä¸å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç \n8. `U+D800~U+DFFF` ï¼ˆå·¦å³è¾¹ç•Œä¸å¯å–ï¼‰æ˜¯ä¿ç•™æ®µï¼Œä¸å¯ä»¥ä½¿ç”¨\n\né‚£ä¹ˆçœ‹çœ‹åˆšæ‰çš„ä¾‹å­ï¼Œæˆ‘ä»¬å–å‡ºç¬¬ä¸€ä¸ªå­—èŠ‚ `0xE6`ï¼ˆå³ `1110 0110`ï¼‰ï¼Œæˆ‘è¦é€ä¸€çš„å°è¯•æ¯ä¸€ç§æƒ…å†µï¼Œæœ€åæˆ‘ä»¬å‘ç°å®ƒçš„æœ€é«˜ 4 ä½æ˜¯ `1110` é‚£ä¹ˆå®ƒä¹‹åçš„ä¸¤ä¸ªå­—èŠ‚å’Œå®ƒä¸€èµ·è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚\n\n1. é¦–å…ˆæˆ‘ä»¬å…ˆå°†ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ä¸Š `0xF`ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å®é™…çš„ 4 ä½\n2. å–å‡ºç´§éšçš„ç¬¬äºŒä¸ªå­—èŠ‚ï¼Œå°†å…¶ä¸ä¸Š `0x3F`ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å®é™…çš„ 6 ä½\n3. å–å‡ºç´§éšçš„ç¬¬ä¸‰ä¸ªå­—èŠ‚ï¼Œå°†å…¶ä¸ä¸Š `0x3F`ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å®é™…çš„ 6 ä½\n\næœ€åå°†è¿™ 16 ä¸ªæ•°ä½æŒ‰ç…§å–å‡ºçš„é¡ºåºä»å·¦å¾€å³æ”¾å­˜æ”¾åˆ°ä¸‰ä¸ªå­—èŠ‚ä¸­ã€‚\n\n## ä»£ç \nå…ˆæ”¾ javascript çš„ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨äº† ES6 ä¸­çš„ `String.prototype.codePointAt` æ–¹æ³•ï¼Œå› ä¸ºåœ¨ ES5 ä¸­å¯¹äºè¶…è¿‡äº† `0xFFFF` çš„å­—ç¬¦ä½¿ç”¨ `String.prototype.charCodeAt` å¹¶ä¸èƒ½æ­£ç¡®çš„è·å–å…¶ unicode ç¼–ç :\n\n```js\n\"use strict\";\n\nconsole.assert(typeof String.prototype.codePointAt == 'function', \"Current env doesn't support ECMAScript 6!\");\n\nArray.prototype.equal = function (b) {\n    return this.every(function (e, i) {\n        return e === b[i];\n    });\n};\n\nvar unicode2utf8 = function (unicode) {\n    unicode = typeof unicode == 'string' ? unicode.codePointAt(0) : unicode;\n\n    if (unicode <= 0x7F) {\n        return [unicode]\n    } else if (unicode >= 0x80 && unicode <= 0x7FF) {\n        return [\n            unicode >> 6 | 0xC0,\n            unicode & 0x3F | 0x80\n        ];\n    } else if (unicode >= 0x800 && unicode <= 0xFFFF) {\n        return [\n            unicode >> 12 | 0xE0,\n            (unicode & 0xFC0) >> 6 | 0x80,\n            unicode & 0x3F | 0x80\n        ];\n    } else if (unicode >= 0x10000 && unicode <= 0x10FFFF) {\n        return [\n            unicode >> 18 | 0xF0,\n            (unicode & 0x3F000) >> 12 | 0x80,\n            (unicode & 0xFC0) >> 6 | 0x80,\n            unicode & 0x3F | 0x80\n        ];\n    } else {\n        throw new Error('deformed unicode: ' + unicode);\n    }\n};\n\nconsole.assert(unicode2utf8('u').equal([0x75]), \"unicode2utf8 not pass 'u'\");\nconsole.assert(unicode2utf8('Â©').equal([0xC2, 0xA9]), \"unicode2utf8 not pass 'Â©'\");\nconsole.assert(unicode2utf8('æ±‰').equal([0xE6, 0xB1, 0x89]), \"unicode2utf8 not pass 'æ±‰'\");\nconsole.assert(unicode2utf8('ğŸ˜„').equal([0xF0, 0x9F, 0x98, 0x84]), \"unicode2utf8 not pass 'ğŸ˜„'\");\n\nvar utf82unicode = function (utf8) {\n    var ul = utf8.length, byte = utf8[0];\n\n    if (ul == 0) {\n        throw new Error('empty utf8');\n    }\n\n    if (byte <= 127) {\n        return byte;\n    } else if (byte >> 5 == 0x6 && ul == 2) {\n        return ((byte & 0x1F) << 6) |\n                utf8[1] & 0x3F;\n    } else if (byte >> 4 == 0xE && ul == 3) {\n        return ((byte & 0xF) << 12) |\n                ((utf8[1] & 0x3F) << 6) |\n                (utf8[2] & 0x3F)\n    } else if (byte >> 3 == 0x1E && ul == 4) {\n        return ((byte & 0x7) << 18) |\n                ((utf8[1] & 0x3F) << 12) |\n                ((utf8[2] & 0x3F) << 6) |\n                (utf8[3] & 0x3F)\n    } else {\n        throw new Error('deformed utf8: ' + utf8);\n    }\n};\n\nconsole.assert(utf82unicode([0x75]) == 'u'.codePointAt(0), \"utf82unicode not pass 'u'\");\nconsole.assert(utf82unicode([0xC2, 0xA9]) == 'Â©'.codePointAt(0), \"utf82unicode not pass 'Â©'\");\nconsole.assert(utf82unicode([0xE6, 0xB1, 0x89]) == 'æ±‰'.codePointAt(0), \"utf82unicode not pass 'æ±‰'\");\nconsole.assert(utf82unicode([0xF0, 0x9F, 0x98, 0x84]) == 'ğŸ˜„'.codePointAt(0), \"utf82unicode not pass 'ğŸ˜„'\");\n```\n\næ¥ä¸‹æ¥æ˜¯ golang çš„ï¼Œå…¶ä¸­çš„ `IsIntactUtf8` å‡½æ•°å°±æ˜¯æœ¬æ–‡è®¨è®ºçš„ä¸»é¢˜ - æ£€æŸ¥UTF-8ç¼–ç çš„å®Œæ•´æ€§ï¼š\n\n```go\nfunc Unicode2utf8(u uint32) (u8 []byte, err error) {\n\tif u <= 0x7F {\n\t\treturn []byte{byte(u)}, nil\n\t} else if u >= 0x80 && u <= 0x7FF {\n\t\treturn []byte{\n\t\t\tbyte(u>>6 | 0xC0),\n\t\t\tbyte(u&0x3F | 0x80),\n\t\t}, nil\n\t} else if u >= 0x800 && u <= 0xFFFF {\n\t\treturn []byte{\n\t\t\tbyte(u>>12 | 0xE0),\n\t\t\tbyte((u&0xFC0)>>6 | 0x80),\n\t\t\tbyte(u&0x3F | 0x80),\n\t\t}, nil\n\t} else if u >= 0x10000 && u <= 0x10FFFF {\n\t\treturn []byte{\n\t\t\tbyte(u>>18 | 0xF0),\n\t\t\tbyte((u&0x3F000)>>12 | 0x80),\n\t\t\tbyte((u&0xFC0)>>6 | 0x80),\n\t\t\tbyte(u&0x3F | 0x80),\n\t\t}, nil\n\t}\n\n\treturn nil, errors.New(fmt.Sprintf(\"deformed unicode: %d\", u))\n}\n\nfunc TestUnicode2utf8(t *testing.T) {\n\tu8, _ := Unicode2utf8(0x75)\n\tif !reflect.DeepEqual(u8, []byte{0x75}) {\n\t\tt.Fatal(\"not pass 'u'\")\n\t}\n\n\tu8, _ = Unicode2utf8(0xA9)\n\tif !reflect.DeepEqual(u8, []byte{0xC2, 0xA9}) {\n\t\tt.Fatal(\"not pass 'Â©'\")\n\t}\n\n\tu8, _ = Unicode2utf8(0x6C49)\n\tif !reflect.DeepEqual(u8, []byte{0xE6, 0xB1, 0x89}) {\n\t\tt.Fatal(\"not pass 'æ±‰'\")\n\t}\n\n\tu8, _ = Unicode2utf8(0x1F604)\n\tif !reflect.DeepEqual(u8, []byte{0xF0, 0x9F, 0x98, 0x84}) {\n\t\tt.Fatal(\"not pass 'ğŸ˜„'\")\n\t}\n}\n\nfunc Utf82unicode(u8 []byte) (u uint32, err error) {\n\tu8l := len(u8)\n\n\tif u8l == 0 {\n\t\treturn 0, errors.New(\"empty utf8\")\n\t}\n\n\tb1 := u8[0]\n\tif b1 <= 0x7F {\n\t\treturn uint32(b1), nil\n\t} else if b1>>5 == 0x6 && u8l == 2 {\n\t\treturn uint32(b1&0x1F)<<6 |\n\t\t\tuint32(u8[1]&0x3F), nil\n\t} else if b1>>4 == 0xE && u8l == 3 {\n\t\treturn uint32(b1&0xF)<<12 |\n\t\t\tuint32(u8[1]&0x3F)<<6 |\n\t\t\tuint32(u8[2]&0x3F), nil\n\n\t} else if b1>>3 == 0x1E && u8l == 4 {\n\t\treturn uint32(b1&0x7)<<18 |\n\t\t\tuint32(u8[1]&0x3F)<<12 |\n\t\t\tuint32(u8[2]&0x3F)<<6 |\n\t\t\tuint32(u8[3]&0x3F), nil\n\t}\n\n\treturn 0, errors.New(fmt.Sprintf(\"deformed utf8: %d\", u8))\n}\n\nfunc TestUtf82unicode(t *testing.T) {\n\tu, _ := Utf82unicode([]byte{0x75})\n\tif u != 0x75 {\n\t\tt.Fatal(\"not pass 'u'\")\n\t}\n\n\tu, _ = Utf82unicode([]byte{0xC2, 0xA9})\n\tif u != 0xA9 {\n\t\tt.Fatal(\"not pass 'Â©'\")\n\t}\n\n\tu, _ = Utf82unicode([]byte{0xE6, 0xB1, 0x89})\n\tif u != 0x6C49 {\n\t\tt.Fatalf(\"not pass 'æ±‰': %x\", u)\n\t}\n\n\tu, _ = Utf82unicode([]byte{0xF0, 0x9F, 0x98, 0x84})\n\tif u != 0x1F604 {\n\t\tt.Fatal(\"not pass 'ğŸ˜„'\")\n\t}\n}\n\nfunc IsIntactUtf8(u8 []byte) bool {\n\ti := 0\n\tu8l := len(u8)\n\n\tfor {\n\t\tif i == u8l {\n\t\t\tbreak\n\t\t}\n\n\t\tb1 := u8[i]\n\t\tvar tu uint32\n\n\t\tswitch {\n\t\tcase b1 <= 0x7F:\n\t\tcase b1>>5 == 0x6:\n\t\t\tif u8l-i >= 2 &&\n\t\t\t\tu8[i+1]&0xC0 == 0x80 &&\n\t\t\t\t// U+0000 encoded in two bytes: incorrect\n\t\t\t\t(u8[i] > 0xC0 || u8[i+1] > 0x80) {\n\t\t\t\ti++\n\t\t\t} else {\n\t\t\t\treturn false\n\t\t\t}\n\t\tcase b1>>4 == 0xE:\n\t\t\tif u8l-i >= 3 {\n\t\t\t\ttu = uint32(b1&0xF)<<12 |\n\t\t\t\t\tuint32(u8[i+1]&0x3F)<<6 |\n\t\t\t\t\tuint32(u8[i+2]&0x3F)\n\n\t\t\t\t// UTF-8 prohibits encoding character numbers between U+D800 and U+DFFF\n\t\t\t\tif tu >= 0x800 && tu <= 0xFFFF && !(tu >= 0xD800 && tu <= 0xDFFF) {\n\t\t\t\t\ti += 2\n\t\t\t\t} else {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false\n\t\t\t}\n\t\tcase b1>>3 == 0x1E:\n\t\t\tif u8l-i >= 4 &&\n\t\t\t\tu8[i]&0x7 <= 0x4 &&\n\t\t\t\tu8[i+1]&0xC0 == 0x80 && u8[i+1]&0x3F <= 0xF &&\n\t\t\t\tu8[i+2]&0xC0 == 0x80 &&\n\t\t\t\tu8[i+3]&0xC0 == 0x80 {\n\t\t\t\ti += 3\n\t\t\t} else {\n\t\t\t\treturn false\n\t\t\t}\n\t\tdefault:\n\t\t\treturn false\n\t\t}\n\t\ti++\n\t}\n\n\treturn i == u8l\n}\n\ntype ValidTest struct {\n\tin  string\n\tout bool\n}\n\nvar validTests = []ValidTest{\n\t{\"\", true},\n\t{\"a\", true},\n\t{\"abc\", true},\n\t{\"Ğ–\", true},\n\t{\"Ğ–Ğ–\", true},\n\t{\"Ğ±Ñ€ÑĞ´-Ğ›Ğ“Ğ¢Ğœ\", true},\n\t{\"â˜ºâ˜»â˜¹\", true},\n\t{string([]byte{66, 250}), false},\n\t{string([]byte{66, 250, 67}), false},\n\t{\"a\\uFFFDb\", true},\n\t{string(\"\\xF4\\x8F\\xBF\\xBF\"), true},      // U+10FFFF\n\t{string(\"\\xF4\\x90\\x80\\x80\"), false},     // U+10FFFF+1; out of range\n\t{string(\"\\xF7\\xBF\\xBF\\xBF\"), false},     // 0x1FFFFF; out of range\n\t{string(\"\\xFB\\xBF\\xBF\\xBF\\xBF\"), false}, // 0x3FFFFFF; out of range\n\t{string(\"\\xc0\\x80\"), false},             // U+0000 encoded in two bytes: incorrect\n\t{string(\"\\xed\\xa0\\x80\"), false},         // U+D800 high surrogate (sic)\n\t{string(\"\\xed\\xbf\\xbf\"), false},         // U+DFFF low surrogate (sic)\n}\n\nfunc TestIsIntactUtf8(t *testing.T) {\n\tfor i, tt := range validTests {\n\t\tif IsIntactUtf8([]byte(tt.in)) != tt.out {\n\t\t\tt.Fatalf(\"[CASE %d] IsIntactUtf8(%q) = %v; want %v\", i, tt.in, !tt.out, tt.out)\n\t\t}\n\t}\n}\n```\n\nåŸç†ä»¥åŠä»£ç éƒ½ç»™å‡ºæ¥äº†ï¼Œåº”è¯¥ä¼šå¯¹ UTF-8 ä»¥åŠ UTF-8 ä¸ Unicode ä¹‹é—´çš„å…³ç³»ä¸æ˜äº†çš„åŒå­¦æœ‰äº›å¸®åŠ©å§ã€‚\n","slug":"/os/UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§","toc":[{"name":"ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥ UTF-8 ç¼–ç ","depth":2,"anchor":"#ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥UTF-8ç¼–ç ","children":[]},{"name":"","depth":2,"anchor":"#","children":[]},{"name":"","depth":2,"anchor":"#","children":[]},{"name":"UTF-8 çš„ç¼–ç æ–¹å¼","depth":2,"anchor":"#UTF-8çš„ç¼–ç æ–¹å¼","children":[]},{"name":"ä»£ç ","depth":2,"anchor":"#ä»£ç ","children":[]}],"keywords":[],"mtime":1615393171083},"catalog":[{"name":"v8","url":"/post/v8","children":[{"name":"debug-v8-in-vscode","url":"/post/v8/debug-v8-in-vscode.html","children":[]},{"name":"v8 å¸¸è§æ•°æ®ç±»å‹","url":"/post/v8/common-data-types.html","children":[]}]},{"name":"deno","url":"/post/deno","children":[{"name":"deno native plugin å†…éƒ¨å®ç°æœºåˆ¶","url":"/post/deno/native-plugin.html","children":[]}]},{"name":"crypto","url":"/post/crypto","children":[{"name":"åŠ å¯†ç®—æ³•è°ƒç ”","url":"/post/crypto/brief-crypto.html","children":[]}]},{"name":"nodejs","url":"/post/nodejs","children":[{"name":"Cluster æ¨¡å—åˆ†æ","url":"/post/nodejs/Cluster æ¨¡å—åˆ†æ.html","children":[]},{"name":"build-from-source","url":"/post/nodejs/build-from-source.html","children":[]},{"name":"node-addon","url":"/post/nodejs/node-addon.html","children":[]},{"name":"common-snippet","url":"/post/nodejs/common-snippet.html","children":[]},{"name":"v8 Heapsnapshot æ–‡ä»¶è§£æ","url":"/post/nodejs/heap-snapshot.html","children":[]},{"name":"Libuv ä¹‹ - åªçœ‹è¿™ç¯‡æ˜¯ä¸å¤Ÿçš„","url":"/post/nodejs/libuv.html","children":[]},{"name":"Objects in V8","url":"/post/nodejs/object-in-v8.html","children":[]},{"name":"Libuv ä¹‹ä¸Šçš„ Node","url":"/post/nodejs/node-on-libuv.html","children":[]}]},{"name":"websocket","url":"/post/websocket","children":[{"name":"WebSocket åè®® 1~4 èŠ‚","url":"/post/websocket/WebSocket åè®® 1~4 èŠ‚.html","children":[]},{"name":"WebSocket åè®® 5~10 èŠ‚","url":"/post/websocket/WebSocket åè®® 5~10 èŠ‚.html","children":[]}]},{"name":"assembly","url":"/post/assembly","children":[{"name":"æ±‡ç¼–è¯­è¨€å­¦ä¹ å°ç»“","url":"/post/assembly/æ±‡ç¼–è¯­è¨€å­¦ä¹ å°ç»“.html","children":[]}]},{"name":"typescript","url":"/post/typescript","children":[{"name":"Decorator in babel and tsc","url":"/post/typescript/decorator.html","children":[]}]},{"name":"rust","url":"/post/rust","children":[{"name":"Lifetime","url":"/post/rust/lifetime.html","children":[]}]},{"name":"oop","url":"/post/oop","children":[{"name":"midway åˆ†æ","url":"/post/oop/ioc.html","children":[]}]},{"name":"php","url":"/post/php","children":[{"name":"ä¸ºä»€ä¹ˆ PHP ä¸é€‚åˆé•¿æ—¶é—´è¿è¡Œ","url":"/post/php/ä¸ºä»€ä¹ˆ PHP ä¸é€‚åˆé•¿æ—¶é—´è¿è¡Œ.html","children":[]}]},{"name":"blockchain","url":"/post/blockchain","children":[{"name":"crypto-conditions ç®€è¿°","url":"/post/blockchain/crypto-conditions ç®€è¿°.html","children":[]},{"name":"å®ç”¨æ‹œå åº­å®¹é”™ç®€ä»‹","url":"/post/blockchain/å®ç”¨æ‹œå åº­å®¹é”™ç®€ä»‹.html","children":[]}]},{"name":"browser","url":"/post/browser","children":[{"name":"æµè§ˆå™¨å¼‚æ­¥åŠ è½½å’ŒåŒæºç­–ç•¥","url":"/post/browser/æµè§ˆå™¨å¼‚æ­¥åŠ è½½å’ŒåŒæºç­–ç•¥.html","children":[]}]},{"name":"cpp","url":"/post/cpp","children":[{"name":"The as-if rule","url":"/post/cpp/the-as-if-rule.html","children":[]}]},{"name":"work","url":"/post/work","children":[{"name":"Parsing in practice","url":"/post/work/parsing-in-practice.html","children":[]}]},{"name":"os","url":"/post/os","children":[{"name":"å¤§å°ç«¯åº","url":"/post/os/å¤§å°ç«¯åº.html","children":[]},{"name":"UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§","url":"/post/os/UTF-8 ç¼–ç åŠæ£€æŸ¥å…¶å®Œæ•´æ€§.html","children":[]},{"name":"é­”æ•° 0x7c00","url":"/post/os/é­”æ•°0x7c00.html","children":[]},{"name":"å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç ","url":"/post/os/å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç .html","children":[]}]},{"name":"javascript","url":"/post/javascript","children":[{"name":"Generator Function","url":"/post/javascript/generator function.html","children":[]},{"name":"è§£æ JSON çš„æˆæœ¬","url":"/post/javascript/è§£æ JSON çš„æˆæœ¬.html","children":[]},{"name":"Javascript å†…éƒ¨çš„å­—ç¬¦ç¼–ç ","url":"/post/javascript/Javascript å†…éƒ¨çš„å­—ç¬¦ç¼–ç .html","children":[]},{"name":"é—­åŒ…çš„ä½œç”¨","url":"/post/javascript/é—­åŒ…çš„ä½œç”¨.html","children":[]},{"name":"é—­åŒ…æ˜¯ä»€ä¹ˆ","url":"/post/javascript/é—­åŒ…æ˜¯ä»€ä¹ˆ.html","children":[]}]},{"name":"static-analysis","url":"/post/static-analysis","children":[{"name":"ä½¿ç”¨ Rust é‡å†™ ternjs","url":"/post/static-analysis/ternjs.html","children":[]}]},{"name":"craft","url":"/post/craft","children":[{"name":"åˆ¶ä½œä¸€ä¸ªå±äºè‡ªå·±çš„è¯­è¨€","url":"/post/craft/create_your_own_lang.html","children":[]}]},{"name":"go","url":"/post/go","children":[{"name":"Go è¯­è¨€ä¸­çš„ Generic è®¾è®¡ç¼ºé™·","url":"/post/go/bad_in_generic_syntax.html","children":[]}]}],"title":"The hard ways"}},"currentRoute":{"pattern":"/post","href":{"pathname":"/post"}},"pageModules":{"/index":["/pages/index.js"],"/post":["/pages/post.css","/pages/post.js"],"/sitemap":["/pages/sitemap.css","/pages/sitemap.js"],"/post/*":["/pages/post.css","/pages/post.js"]},"router":{"basename":"/","hash":false,"routes":["/index","/post","/sitemap","/post/*"]}};</script><script crossorigin="anonymous" src="/app.js"></script><script crossorigin="anonymous" src="/foundation.js"></script><script crossorigin="anonymous" src="/lib.js"></script><script crossorigin="anonymous" src="/shared-pages_post_tsx.js"></script><script crossorigin="anonymous" src="/pages/post.js"></script></body></html>